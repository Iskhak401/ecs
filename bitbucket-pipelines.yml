
image: hashicorp/terraform:latest
pipelines:     
    branches:
        master:        
            - step:
                deployment: "Development"
                script:
                    - apt-get update
                    - apt-get install -y zip 
                    - apt-get install -y jq 
                    - curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
                    - unzip awscliv2.zip
                    - ./aws/install
                    - aws --version 
                    - aws configure set aws_access_key_id $AWS_ACCESS_KEY_ID
                    - aws configure set aws_secret_access_key $AWS_SECRET_ACCESS_KEY
                    - aws configure set default.region $TF_VAR_aws_region
                    - terraform init -backend-config="bucket=${AWS_S3_STATE_BUCKET}"                  
                    - terraform plan
                    - terraform apply -input=false -auto-approve